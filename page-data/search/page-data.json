{"componentChunkName":"component---src-pages-search-jsx","path":"/search/","result":{"data":{"allMarkdownRemark":{"nodes":[{"excerpt":"Swiftì—ì„œ ì €ìˆ˜ì¤€ ì†Œì¼“ì„ ì§ì ‘ ë‹¤ë£¨ì§€ ì•Šê³ ë„, ì—°ê²° ìƒì„±/ìˆ˜ì‹ /ì†¡ìˆ˜ì‹ ì„ ê¹”ë”í•˜ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆëŠ” í”„ë ˆì„ì›Œí¬ê°€ ì…ë‹ˆë‹¤. ì´ ê¸€ì—ì„œëŠ” í•µì‹¬ íƒ€ì…ì„ ë¹ ë¥´ê²Œ ì •ë¦¬í•œ ë’¤, ì—ì½” ì„œë²„(Echo Server) ë¥¼ ê°„ë‹¨íˆ êµ¬í˜„/í…ŒìŠ¤íŠ¸í•˜ëŠ” íë¦„ìœ¼ë¡œ ì •ë¦¬í•©ë‹ˆë‹¤.  ê°„ë‹¨í•œ TCP ì„œë²„/í´ë¼ì´ì–¸íŠ¸ë¥¼ ë§Œë“¤ ë•Œ ê¸°ì¡´ BSD Socket ê¸°ë°˜ êµ¬í˜„ì€ ì„¤ì •/ì—ëŸ¬ ì²˜ë¦¬/ìƒíƒœ ê´€ë¦¬ê°€â€¦","fields":{"slug":"/network-framework-echo-server/"},"frontmatter":{"date":"August 08, 2025","title":"Network.frameworkë¡œ TCP Echo Server ë§Œë“¤ê¸°","tags":["Swift","iOS","Network","Server"]},"rawMarkdownBody":"\nSwiftì—ì„œ ì €ìˆ˜ì¤€ ì†Œì¼“ì„ ì§ì ‘ ë‹¤ë£¨ì§€ ì•Šê³ ë„, **ì—°ê²° ìƒì„±/ìˆ˜ì‹ /ì†¡ìˆ˜ì‹ **ì„ ê¹”ë”í•˜ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆëŠ” í”„ë ˆì„ì›Œí¬ê°€ `Network.framework`ì…ë‹ˆë‹¤.  \nì´ ê¸€ì—ì„œëŠ” í•µì‹¬ íƒ€ì…ì„ ë¹ ë¥´ê²Œ ì •ë¦¬í•œ ë’¤, **ì—ì½” ì„œë²„(Echo Server)** ë¥¼ ê°„ë‹¨íˆ êµ¬í˜„/í…ŒìŠ¤íŠ¸í•˜ëŠ” íë¦„ìœ¼ë¡œ ì •ë¦¬í•©ë‹ˆë‹¤.\n\n## `Network.framework`\n\nê°„ë‹¨í•œ TCP ì„œë²„/í´ë¼ì´ì–¸íŠ¸ë¥¼ ë§Œë“¤ ë•Œ ê¸°ì¡´ BSD Socket ê¸°ë°˜ êµ¬í˜„ì€ ì„¤ì •/ì—ëŸ¬ ì²˜ë¦¬/ìƒíƒœ ê´€ë¦¬ê°€ ë²ˆê±°ë¡œìš´ í¸ì…ë‹ˆë‹¤.  `Network.framework`ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒì„ ë¹„êµì  ì§ê´€ì ìœ¼ë¡œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n- ì„œë²„: ë¦¬ìŠ¨(í¬íŠ¸ ë°”ì¸ë”©) â†’ ì¸ë°”ìš´ë“œ ì—°ê²° ìˆ˜ë½ â†’ ìˆ˜ì‹ /ì‘ë‹µ ë£¨í”„\n- í´ë¼ì´ì–¸íŠ¸: ì—°ê²° â†’ ìƒíƒœ ê´€ì°° â†’ ì†¡ì‹  â†’ ìˆ˜ì‹ \n\në„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ ìƒì„±í•œ í›„, HTTP ë˜ëŠ” TLSì™€ ê°™ì€ ì „ì†¡ ë° ë³´ì•ˆ í”„ë¡œí† ì½œì„ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ìŠµë‹ˆë‹¤.  \nì´ë²ˆ ê¸€ì—ì„œëŠ” ì—°ê²° ë° ì†¡ìˆ˜ì‹ ì˜ ë¼ˆëŒ€ë¥¼ ì´í•´í•˜ëŠ” ë° í•„ìš”í•œ ëŒ€í‘œ íƒ€ì… 3ê°œë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ë´…ë‹ˆë‹¤.\n\n### NWEndpoint\n\në¡œì»¬ ë˜ëŠ” ì™¸ë¶€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í‘œí˜„í•©ë‹ˆë‹¤. ì—°ê²°ì˜ ëª©ì ì§€ë¥¼ ì§€ì •í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.\n\n- `hostPort(host:port:)`: í˜¸ìŠ¤íŠ¸/í¬íŠ¸ ì¡°í•© ì—”ë“œí¬ì¸íŠ¸\n\n```swift\nlet endPoint = NWEndpoint.hostPort(\n  host: NWEndpoint.Host(\"127.0.0.1\"),\n  port: NWEndpoint.Port(integerLiteral: 9999)\n)\n```\n\n### NWListener\n\në„¤íŠ¸ì›Œí¬ ì—°ê²° ìš”ì²­ì„ ìˆ˜ì‹ í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë¦¬ìŠ¤ë‹ ê°ì²´ì…ë‹ˆë‹¤. ì„œë²„ ì¸¡ì˜ ì‹œì‘ì ì…ë‹ˆë‹¤.\n\n- `start(queue:)`: ë¦¬ìŠ¤ë„ˆë¥¼ ì‹œì‘í•˜ê³  ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•  íë¥¼ ì§€ì •í•©ë‹ˆë‹¤.\n- `newConnectionHandler`: ë“¤ì–´ì˜¤ëŠ” ì—°ê²°ì„ ìˆ˜ë½í•œ ë’¤ ì„¸ì…˜ ì²˜ë¦¬ë¥¼ ì‹œì‘í•˜ëŠ” í•¸ë“¤ëŸ¬ì…ë‹ˆë‹¤.\n\n```swift\nfunc start() {\n  listener.newConnectionHandler = { connection in\n    self.handleConnection(connection: connection)\n  }\n  listener.start(queue: listenerQueue)\n}\n```\n\n### NWConnection\n\në¡œì»¬ê³¼ ì›ê²© ì—”ë“œí¬ì¸íŠ¸ ê°„ì˜ ë°ì´í„° ì—°ê²°(ì„¸ì…˜)ì…ë‹ˆë‹¤. ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ì–‘ìª½ì—ì„œ ëª¨ë‘ ì‚¬ìš©í•©ë‹ˆë‹¤.\n\n- `start(queue:)`: ì—°ê²°ì„ ì‹œì‘í•˜ê³  ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•  íë¥¼ ì§€ì •í•©ë‹ˆë‹¤.\n- `stateUpdateHandler`: ì—°ê²° ìƒíƒœê°€ ë°”ë€” ë•Œë§ˆë‹¤ í˜¸ì¶œë©ë‹ˆë‹¤.\n\n```swift\nfunc connect() {\n  connection.stateUpdateHandler = { state in\n    switch state {\n    case .setup: break            // ì´ˆê¸° ìƒíƒœ\n    case .waiting(let error):     // ë„¤íŠ¸ì›Œí¬ ëŒ€ê¸°/ì¬ì‹œë„ ìƒí™©\n      print(error)\n    case .preparing: break        // ì—°ê²° ì¤€ë¹„\n    case .ready: break            // ì—°ê²° ì„±ê³µ (ì†¡ìˆ˜ì‹  ê°€ëŠ¥)\n    case .failed(let error):      // ì—°ê²° ì‹¤íŒ¨\n      print(error)\n    case .cancelled: break        // ì—°ê²° ì·¨ì†Œ\n    @unknown default: break\n    }\n  }\n  connection.start(queue: .global())\n}\n```\n\n- `send(content:contentContext:isComplete:completion:)`: í™œì„± ì—°ê²°ì„ í†µí•´ ë°ì´í„°ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.\n  - `content`: ë³´ë‚¼ `Data?` (nilì´ë©´ â€œì½˜í…ì¸  ì—†ëŠ” í”„ë ˆì„â€ ì„±ê²©)\n  - `contentContext`: ë©”ì‹œì§€ ë©”íƒ€ë°ì´í„°(í”„ë¡œí† ì½œ/ìš°ì„ ìˆœìœ„ ë“±). ì¼ë°˜ì ì¸ TCP ìŠ¤íŠ¸ë¦¼ì—ì„œëŠ” `.defaultMessage`\n  - `isComplete`: ì´ sendê°€ â€œë©”ì‹œì§€ ê²½ê³„â€ë¡œ ì™„ê²°ë˜ëŠ”ì§€ í‘œì‹œ(ìŠ¤íŠ¸ë¦¼ì—ì„œë„ í”„ë ˆì´ë° íŒíŠ¸ë¡œ ì‚¬ìš©)\n  - `completion`: ì „ì†¡ ê²°ê³¼ ì½œë°±(ì—ëŸ¬ í¬í•¨)\n\n## ì—ì½” ì„œë²„ (Echo Server)\n\nì—ì½” ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë°›ì€ ë°ì´í„°ë¥¼ **ê·¸ëŒ€ë¡œ ë‹¤ì‹œ ëŒë ¤ì£¼ëŠ”** ì„œë²„ì…ë‹ˆë‹¤. êµ¬í˜„ì´ ë‹¨ìˆœí•´ì„œ ë„¤íŠ¸ì›Œí¬ í•™ìŠµ/í…ŒìŠ¤íŠ¸ì— ìì£¼ ì‚¬ìš©ë©ë‹ˆë‹¤.\n\n### ì£¼ìš” ì‚¬ìš© ëª©ì \n\n- **ë„¤íŠ¸ì›Œí¬ í…ŒìŠ¤íŠ¸**: ì†Œì¼“ í†µì‹ ì´ ì˜ ë˜ëŠ”ì§€, ì§€ì—° ì‹œê°„, íŒ¨í‚· ì†ì‹¤ ë“±ì„ í™•ì¸\n- **í´ë¼ì´ì–¸íŠ¸ ê°œë°œ ê²€ì¦**: ë©”ì‹œì§€ ì†¡ìˆ˜ì‹  ê¸°ëŠ¥ì´ ì •í™•íˆ ë™ì‘í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸\n- **í”„ë¡œí† ì½œ ë””ë²„ê¹…**: TCP/UDP, TLS ë“± ê³„ì¸µ ë³„ ë™ì‘ í™•ì¸\n- **ì„±ëŠ¥ ì¸¡ì •**: RTT(ì™•ë³µ ì‹œê°„) ì¸¡ì •, ì‘ë‹µ ì†ë„ í…ŒìŠ¤íŠ¸\n\n### êµ¬í˜„ í¬ì¸íŠ¸\n\nì´ë²ˆ ì‹¤ìŠµì˜ í•µì‹¬ íë¦„ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\n\n#### **ì„œë²„**\n\n- `NWListener`ë¡œ í¬íŠ¸ ë¦¬ìŠ¨\n- `newConnectionHandler`ì—ì„œ `NWConnection` ìˆ˜ë½\n- ì—°ê²°ì´ `.ready`ê°€ ë˜ë©´ `receive` ë£¨í”„ë¡œ ë°ì´í„° ìˆ˜ì‹ \n- ìˆ˜ì‹ í•œ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ `send`ë¡œ ë‹¤ì‹œ ì „ì†¡\n\n``` swift\nimport Foundation\nimport Network\n\nclass EchoServer {\n    let tcpListener: NWListener\n    let listenerQueue = DispatchQueue(label: \"ListenerQueue\")\n\n    init(\n        port: NWEndpoint.Port\n    ) throws {\n        do {\n            self.tcpListener = try NWListener(using: .tcp, on: port)\n        } catch {\n            throw error\n        }\n    }\n\n    func start() {\n        print(\"ì„œë²„ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.\")\n        tcpListener.newConnectionHandler = { connection in\n            print(\"ìƒˆ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°!\")\n            self.handleConnection(connection: connection)\n        }\n\n        tcpListener.start(queue: .main)\n    }\n\n    func handleConnection(connection: NWConnection) {\n        connection.start(queue: listenerQueue)\n        recieve(on: connection)\n    }\n\n    func recieve(on connection: NWConnection) {\n        connection.receive(minimumIncompleteLength: 1, maximumLength: 4096) { content, contentContext, isComplete, error in\n            guard let content = content else { return }\n            print(\"ìˆ˜ì‹  ë°ì´í„°: \\(String(data: content, encoding: .utf8)!)\")\n\n            connection.send(\n                content: content,\n                completion: .contentProcessed( { error in\n                    if let error = error {\n                        print(\"ì¬ì „ì†¡ ì—ëŸ¬: \\(error)\")\n                    }\n                    self.recieve(on: connection)\n                })\n            )\n        }\n    }\n}\n```\n\n####  **í´ë¼ì´ì–¸íŠ¸**\n\n- `NWConnection(host:port:using:)`ìœ¼ë¡œ ì„œë²„ì— ì—°ê²°\n- ì—°ê²° `.ready` ì´í›„ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ `send`\n- `receive`ë¡œ ì„œë²„ ì‘ë‹µì„ í™•ì¸\n\n``` swift\nimport Foundation\nimport Network\n\nclass Client {\n    let connection: NWConnection\n    \n    init(endPoint: NWEndpoint) {\n        self.connection = NWConnection(to: endPoint, using: .tcp)\n    }\n    \n    func connect() {\n        connection.stateUpdateHandler = { state in\n            switch state {\n            case .setup:\n                print(\"setup\")\n            case .waiting(let error):\n                print(\"waiting \\(error)\")\n            case .preparing:\n                print(\"preparing\")\n            case .ready:\n                self.startRecieve()\n            case .failed(let error):\n                print(\"failed \\(error)\")\n            case .cancelled:\n                print(\"cancelled\")\n            @unknown default:\n                print(\"none\")\n            }\n        }\n        \n        connection.start(queue: DispatchQueue.global())\n        \n        while let input = readLine() {\n            send(input)\n        }\n    }\n    \n    func startRecieve() {\n        connection.receive(minimumIncompleteLength: 1, maximumLength: 4096) { content, contentContext, isComplete, error in\n            if let content = content {\n                print(\"ìˆ˜ì‹  ë°ì´í„°: \\(String(data: content, encoding: .utf8)!)\")\n            }\n            self.startRecieve()\n        }\n        \n    }\n    \n    func send(_ request: String) {\n        let data = request.data(using: .utf8)\n        connection.send(content: data, completion: .contentProcessed { error in\n            if let error = error {\n                print(\"send error: \\(error)\")\n            }\n        })\n    }\n}\n```\n\n### ì‹¤í–‰/í…ŒìŠ¤íŠ¸\n\n- ì„œë²„ ë¨¼ì € ì‹¤í–‰(í¬íŠ¸ 9999)\n- í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ í›„ ë¬¸ìì—´ ì…ë ¥\n- ê¸°ëŒ€ ê²°ê³¼: ì„œë²„/í´ë¼ì´ì–¸íŠ¸ ëª¨ë‘ì—ì„œ ë™ì¼í•œ ë¬¸ìì—´ì´ ì¶œë ¥(ì—ì½”)\n#### ì„œë²„\n\n![](echo-server.png)\n#### í´ë¼ì´ì–¸íŠ¸\n\n![](echo-server-client.png)\n\n## ë§ˆì¹˜ë©°\n\n`Network.framework`ë¥¼ ì‚¬ìš©í•˜ë©´ â€œì—°ê²° ìƒíƒœ ê´€ë¦¬ + ì´ë²¤íŠ¸ ê¸°ë°˜ ì†¡ìˆ˜ì‹ â€ì„ ë¹„êµì  ê³ ìˆ˜ì¤€ APIë¡œ êµ¬ì„±í•  ìˆ˜ ìˆì–´, ê°„ë‹¨í•œ ì‹¤ìŠµë¶€í„° ì‹¤ì œ ì œí’ˆ ì½”ë“œê¹Œì§€ í™•ì¥í•˜ê¸°ê°€ ì¢‹ì•˜ìŠµë‹ˆë‹¤.  \níŠ¹íˆ `stateUpdateHandler`ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì—°ê²° ìˆ˜ëª…ì£¼ê¸°ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ë‹¤ë£¨ëŠ” ê°ì„ ì¡ì€ ë’¤ì—ëŠ” ì¬ì—°ê²° ì •ì±… ê°™ì€ ìš”êµ¬ì‚¬í•­ë„ ë‹¨ê³„ì ìœ¼ë¡œ ì–¹ê¸° ì‰¬ìš´ í¸ì´ë¼ê³  ëŠê¼ˆìŠµë‹ˆë‹¤.\n\n## ì°¸ê³  ìë£Œ\n\n- [Apple Documentation - Network](https://developer.apple.com/documentation/network)\n- [WWDC 2018 - Introducing Network.framework: A modern alternative to Sockets](https://developer.apple.com/videos/play/wwdc2018/715/)\n- [[ê°„ë‹¨ì •ë¦¬] HTTP Request/Response êµ¬ì¡°](https://hahahoho5915.tistory.com/62)\n- [What is HTTP/3? How it is Different From HTTP/2?](https://www.geeksforgeeks.org/computer-networks/what-is-http-3-how-it-is-different-from-http-2/)"},{"excerpt":"ì´ ê¸€ì€ ì´ì „ ë¸”ë¡œê·¸ì—ì„œ ì´ì „í•œ ê¸€ì…ë‹ˆë‹¤. ì´ì „í•˜ëŠ” ê³¼ì •ì—ì„œ ë‚´ìš©ì„ ìˆ˜ì • ë° ë³´ì™„í•˜ì˜€ìŠµë‹ˆë‹¤. SwiftUI í”„ë¡œì íŠ¸ì—ì„œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë„ì…í•œ í›„, ViewModelì˜ ìƒíƒœë¥¼ ë°”ì¸ë”©í•  ë•Œ ë°œìƒí•˜ëŠ” ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í˜„ìƒì„ ë¶„ì„í•˜ê³  ì§ì ‘ í•´ê²°í•œ ê³¼ì •ì„ ê³µìœ í•©ë‹ˆë‹¤. ë¬¸ì œ ìƒí™© ë¡œ CPU/ë©”ëª¨ë¦¬ë¥¼ í™•ì¸í•˜ë˜ ì¤‘, íŠ¹ì • í™”ë©´ì—ì„œ íŒì—…ì„ ì—¬ëŸ¬ ë²ˆ ë„ìš°ë©´ ë©”ëª¨ë¦¬ê°€ ê°ì†Œí•˜â€¦","fields":{"slug":"/swiftui-opensource-memory-leak-solve/"},"frontmatter":{"date":"May 01, 2023","title":"SwiftUI ë¼ì´ë¸ŒëŸ¬ë¦¬ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë¶„ì„ê³¼ ìˆœí™˜ ì°¸ì¡° í•´ê²°","tags":["Swift","iOS","SwiftUI","ë©”ëª¨ë¦¬"]},"rawMarkdownBody":"> ì´ ê¸€ì€ ì´ì „ ë¸”ë¡œê·¸ì—ì„œ ì´ì „í•œ ê¸€ì…ë‹ˆë‹¤. ì´ì „í•˜ëŠ” ê³¼ì •ì—ì„œ ë‚´ìš©ì„ ìˆ˜ì • ë° ë³´ì™„í•˜ì˜€ìŠµë‹ˆë‹¤.\n\nSwiftUI í”„ë¡œì íŠ¸ì—ì„œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë„ì…í•œ í›„, ViewModelì˜ ìƒíƒœë¥¼ ë°”ì¸ë”©í•  ë•Œ ë°œìƒí•˜ëŠ” ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í˜„ìƒì„ ë¶„ì„í•˜ê³  ì§ì ‘ í•´ê²°í•œ ê³¼ì •ì„ ê³µìœ í•©ë‹ˆë‹¤.\n\n## ë¬¸ì œ ìƒí™©\n\n`Debug Navigator`ë¡œ CPU/ë©”ëª¨ë¦¬ë¥¼ í™•ì¸í•˜ë˜ ì¤‘, íŠ¹ì • í™”ë©´ì—ì„œ íŒì—…ì„ ì—¬ëŸ¬ ë²ˆ ë„ìš°ë©´ **ë©”ëª¨ë¦¬ê°€ ê°ì†Œí•˜ì§€ ì•Šê³  ëˆ„ì **ë˜ëŠ” í˜„ìƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.  ë„ì…í•œ ì˜¤í”ˆì†ŒìŠ¤ Popup ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì˜ì‹¬í–ˆê³ , í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ ì›ì¸ì„ ì¢í˜”ìŠµë‹ˆë‹¤.\n\n## ì¬í˜„\n\nPopupì€ í‘œì‹œ ì—¬ë¶€ë¥¼ ì™¸ë¶€ ìƒíƒœì— `Binding`í•©ë‹ˆë‹¤. ì´ë•Œ ë°”ì¸ë”© ëŒ€ìƒì´ **Viewì˜ @State**ì¸ì§€, **ì™¸ë¶€ ê°ì²´(ViewModel)ì˜ ìƒíƒœ**ì¸ì§€ì— ë”°ë¼ ê²°ê³¼ê°€ ë‹¬ëìŠµë‹ˆë‹¤.\n### Viewì˜ `@State` ë°”ì¸ë”©\n\n``` swift\nstruct ContentView: View {\n\t@State var isShowingPopup = false\nÂ  Â  var body: some View {\nÂ  Â  Â  Â  }\nÂ  Â  Â  Â  .popup(isPresented: $isShowingPopup) {\n\tÂ  Â  Â  Â  ...\nÂ  Â  Â  Â  } customize: {\nÂ  Â  Â  Â  Â  Â  $0.autohideIn(2)\nÂ  Â  Â  Â  }\nÂ  Â  }\n}\n```\n\n`@State`ë¥¼ ë°”ì¸ë”©í•œ ê²½ìš°, íŒì—… í‘œì‹œ/í•´ì œ í›„ ê°ì²´ê°€ ì •ìƒ í•´ì œë˜ëŠ” íë¦„ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.\n### ViewModel ìƒíƒœ ë°”ì¸ë”©\n\ní”„ë¡œì íŠ¸ëŠ” MVVM íŒ¨í„´ì„ ì‚¬ìš©í•˜ê³  ìˆì–´ ì´ ì¼€ì´ìŠ¤ê°€ ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤ì˜€ìŠµë‹ˆë‹¤.\n\n``` swift\nfinal class ViewModel: ObservableObject {\nÂ  Â  @Published var isShowingPopup = false\n}\n```\n\n``` swift\nstruct ContentView: View {\n\t@StateObject var viewModel = ViewModel()\nÂ  Â  var body: some View {\nÂ  Â  Â  Â  }\nÂ  Â  Â  Â  .popup(isPresented: $viewModel.isShowingPopup) {\n\tÂ  Â  Â  Â  ...\nÂ  Â  Â  Â  } customize: {\nÂ  Â  Â  Â  Â  Â  $0.autohideIn(2)\nÂ  Â  Â  Â  }\nÂ  Â  }\n}\n```\n\nì™¸ë¶€ ê°ì²´(`ObservableObject`)ì˜ ìƒíƒœë¥¼ ë°”ì¸ë”©í•œ ê²½ìš°, ì¬í˜„ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë°˜ë³µí• ìˆ˜ë¡ ë©”ëª¨ë¦¬ê°€ ëˆ„ì ë˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.\n\n## ë¶„ì„ ë„êµ¬ë¥¼ í†µí•œ ë©”ëª¨ë¦¬ ë¶„ì„\n\n### Memory Graph\n\n![Simple retain cycle](./memory-graph-retain-cycle.png)\n\n`Memory Graph`ëŠ” íŠ¹ì • ì‹œì ì— í• ë‹¹ëœ ê°ì²´ë“¤ê³¼ ì°¸ì¡° ê´€ê³„ë¥¼ ê·¸ë˜í”„ë¡œ ë³´ì—¬ì£¼ëŠ” ë””ë²„ê¹… ë„êµ¬ì…ë‹ˆë‹¤.  \níŒì—…ì´ ì‚¬ë¼ì§„ ì´í›„ ì‹œì ì˜ ê·¸ë˜í”„ì—ì„œ ê´€ë ¨ ê°ì²´ë“¤ì´ í•´ì œë˜ì§€ ì•Šê³  ë‚¨ì•„ ìˆìœ¼ë©°, **retain cycle**ì´ í˜•ì„±ë˜ì–´ ìˆìŒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.\n### Instruments Leaks\n\n![Instrument Leaks](./Instruments-leaks.png)\nInstrumentsì˜ **Leaks** í…œí”Œë¦¿ì€ ì‹¤í–‰ ì¤‘ ëˆ„ìˆ˜ë¡œ ì˜ì‹¬ë˜ëŠ” ë©”ëª¨ë¦¬ë¥¼ ì¶”ì í•©ë‹ˆë‹¤.  ëˆ„ìˆ˜ ì¬í˜„ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë°˜ë³µí–ˆì„ ë•Œ íŠ¹ì • ê°ì²´ê°€ í•´ì œë˜ì§€ ì•ŠëŠ” íë¦„ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.\n\n## ì½”ë“œ ë¶„ì„\n\në¬¸ì œì˜ í•µì‹¬ì€ `autohideIn`ì´ ì„¤ì •ëœ ê²½ìš°, `DispatchWorkItem`ì„ ë§Œë“¤ì–´ ì¼ì • ì‹œê°„ ë’¤ ì‹¤í–‰í•˜ë„ë¡ ìŠ¤ì¼€ì¤„ë§í•˜ëŠ” ë¶€ë¶„ì´ì—ˆìŠµë‹ˆë‹¤.\n\nğŸ“‚ [`Utils.swift`](https://github.com/exyte/PopupView/blob/master/Sources/PopupView/Utils.swift)\n``` swift\nfinal class DispatchWorkHolder {\nÂ  Â  var work: DispatchWorkItem?\n}\n```\n\nğŸ“‚ [`FullscreenPopup.swift`](https://github.com/exyte/PopupView/blob/master/Sources/PopupView/FullscreenPopup.swift)\n``` swift\npublic struct FullscreenPopup<Item: Equatable, PopupContent: View>: ViewModifier {\n\t...\n    var autohideIn: Double?\n\tprivate var dispatchWorkHolder = DispatchWorkHolder()\n    @State private var dismissSource: DismissSource?\n    ....\n    \n\tfunc setupAutohide() {\n\t\tif let autohideIn = autohideIn {\n\t\t\t// í´ë¡œì €ì—ì„œ selfë¥¼ ì•”ë¬µì ìœ¼ë¡œ ìº¡ì²˜í•˜ê³  ìˆë‹¤.\n\t\t\tdispatchWorkHolder.work = DispatchWorkItem(block: { [weak isPresentedRef, weak itemRef] in\n\t\t\t\t...\n\t\t\t\tdismissSource = .autohide\n\t\t\t\t...\n\t\t\t})\n\t\n\t\t\tif sheetPresented, let work = dispatchWorkHolder.work {\n\t\t\t\tDispatchQueue.main.asyncAfter(deadline: .now() + autohideIn, execute: work)\n\t\t\t}\n\t\t}\n\t}\n}\n```\n\n`DispatchWorkHolder`ê°€ `DispatchWorkItem`ì„ ê°•í•˜ê²Œ ë³´ìœ í•˜ê³  ìˆê³  `DispatchWorkItem` í´ë¡œì € ë‚´ë¶€ì—ì„œ `dismissSource`ë¥¼ ë³€ê²½í•˜ëŠ” ê³¼ì •ì—ì„œ `self`ë¥¼ ì•”ë¬µì ìœ¼ë¡œ ìº¡ì²˜í•©ë‹ˆë‹¤. ì´ ì—°ê²°ë¡œ ì¸í•´ ê²°ê³¼ì ìœ¼ë¡œ **ìˆœí™˜ ì°¸ì¡°**ê°€ ë°œìƒí•©ë‹ˆë‹¤.\n\n## í•´ê²° ê³¼ì •\n\nìˆœí™˜ ì°¸ì¡°ë¥¼ ëŠê¸° ìœ„í•´ ì„¸ ê°€ì§€ ì ‘ê·¼ ë°©ë²•ì„ ì‹œë„í•˜ì˜€ìŠµë‹ˆë‹¤.\n### class â†’ structë¡œ ë³€ê²½\n\n`DispatchWorkHolder`ë¥¼ ê°’ íƒ€ì…ìœ¼ë¡œ ë°”ê¾¸ë©´ ì°¸ì¡° ì¹´ìš´íŠ¸ ì¦ê°€ë¥¼ í”¼í•  ìˆ˜ ìˆë‹¤ê³  ìƒê°í•´ ì‹œë„í–ˆìŠµë‹ˆë‹¤.\n\n```swift\nstruct DispatchWorkHolder {\n    var work: DispatchWorkItem?\n    mutating func change(item work: DispathWorkItem) {\n\t    self.work = work\n    }\n}\n\npublic struct FullscreenPopup<Item: Equatable, PopupContent: View>: ViewModifier {\n    @State var dispatchWorkHolder = DispatchWorkHolder()\n    ...\n    func setupAutohide() {\n        if let autohideIn = autohideIn {\n            ...\n\t\t\tlet newWorkItem = DispatchWorkItem(block: { [weak isPresentedRef, weak itemRef] in\n                isPresentedRef?.value.wrappedValue = false\n                itemRef?.value.wrappedValue = nil\n                dismissSource = .autohide\n            })\n            dispatchWorkHolder.change(item: newWorkItem)\n            ...\n        }\n    }\n}\n```\n\nì´ ë°©ë²•ìœ¼ë¡œ ëˆ„ìˆ˜ ìì²´ëŠ” í•´ê²°í•  ìˆ˜ ìˆì—ˆì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì€ ì´ìœ ë¡œ ì±„íƒí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\n- ê°’ íƒ€ì…ì˜ ë³µì‚¬ë¡œ ì¸í•´ ì°¸ì¡°ê°€ ëŠê¸¸ ê°€ëŠ¥ì„±ì´ ì¡´ì¬í•©ë‹ˆë‹¤. \n- SwiftUIì˜ ViewëŠ” ìì£¼ ì¬ìƒì„±ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ì „ workë¥¼ ì•ˆì •ì ìœ¼ë¡œ ì·¨ì†Œ ë° êµì²´ì˜ ëª©ì ì´ í”ë“¤ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n### ì•½í•œ ì°¸ì¡°\n\nì•½í•œ ì°¸ì¡°ë¥¼ í•˜ë©´ Reference countë¥¼ ì¦ê°€ì‹œí‚¤ì§€ ì•ŠìŠµë‹ˆë‹¤. `setupAutohide()` ë‚´ë¶€ì˜ í´ë¡œì €ì—ì„œ `DispatchWorkHolder`ë¥¼ ì¬ì°¸ì¡°í•˜ê¸° ë•Œë¬¸ì— cycleì´ ìƒê¸´ë‹¤ê³  ìƒê°í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ëŠ” í´ë¡œì € êµ¬ë¬¸ì—ì„œ `weak self`ë¥¼ í†µí•´ í•´ê²°í•  ìˆ˜ ìˆì„ ê²ƒì´ë¼ ìƒê°í•˜ì˜€ìŠµë‹ˆë‹¤. \n\n```swift\ndispatchWorkHolder.work = DispatchWorkItem(block: { [weak self, weak isPresentedRef, weak itemRef] in\n\t...\n})\n```\n\ní•˜ì§€ë§Œ ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.\n\n``` \n'weak' may only be applied to class and class-bound protocol types, not 'FullscreenPopup<Item, PopupContent>\n```\n\nì´ëŠ” í˜„ì¬ `FullscreenPopup`ì€ êµ¬ì¡°ì²´ì´ê¸° ë•Œë¬¸ì— ë°œìƒí•œ ì—ëŸ¬ì…ë‹ˆë‹¤. êµ¬ì¡°ì²´ëŠ” ARCì˜ ëŒ€ìƒì´ ì•„ë‹ˆê³  ì•½í•œ ì°¸ì¡°ì˜ ê°œë…ì€ classì—ë§Œ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ì´ëŠ” í•´ê²° ë°©ë²•ì´ ë  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.\n\n### ì§ì ‘ í• ë‹¹ í•´ì œ\n\nì°¸ì¡° íšŸìˆ˜(Reference Count)ë¥¼ ì¤„ì´ê¸° ìœ„í•´, **ì‘ì—…ì´ ì™„ë£Œë˜ëŠ” ì‹œì ì— `DispatchWorkItem`ì„ ì§ì ‘ `nil`ë¡œ ì„¤ì •**í•˜ì—¬ ì‚¬ì´í´ì„ ëŠì–´ì£¼ì—ˆìŠµë‹ˆë‹¤.\n\n```swift\ndispatchWorkHolder.work = DispatchWorkItem(block: { [weak isPresentedRef, weak itemRef] in\n\t...\n\tdismissSource = .autohide\n\tdispatchWorkHolder.work = nil // ì¶”ê°€\n})\n```\n\nì´ë¥¼ í†µí•´ ì‚¬ì´í´ì„ ì œê±°í•˜ê³  ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¥¼ í•´ê²°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ ìˆ˜ì • í›„, ì•„ë˜ì™€ ê°™ì´ Instrumentsì—ì„œ ë” ì´ìƒ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ë°œê²¬ë˜ì§€ ì•ŠìŒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.\n\n![ì‚¬ë¼ì§„ ëˆ„ìˆ˜ ìœ„í—˜](./instruments-leaks-solve.png)\n## ë§ˆì¹˜ë©°\n\ní™•ë³´í•œ ë©”ëª¨ë¦¬ ìì²´ëŠ”Â ì‚¬ì†Œí• Â ìˆ˜ ìˆì§€ë§Œ,Â ì‘ì€ ëˆ„ìˆ˜ê°€Â ìŒ“ì´ë©´Â í° ë¬¸ì œë¡œÂ ì´ì–´ì§ˆ ìˆ˜ ìˆë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜Â ì½”ë“œë² ì´ìŠ¤ê°€Â í¬ì§€Â ì•Šì•„Â í•´ê²°í• Â ìˆ˜ ìˆì—ˆì§€ë§Œ, ì½”ë“œ í•œÂ ì¤„ì˜Â í•´ê²°ì±…ì„Â ì°¾ê¸°ê¹Œì§€Â ì½”ë“œÂ ë¶„ì„, ë©”ëª¨ë¦¬ ê´€ë¦¬, ì°¸ì¡° ê´€ê³„ ê³µë¶€ì—Â ì˜¤ëœ ì‹œê°„ í• ì• í•˜ì˜€ìŠµë‹ˆë‹¤.\n\ní¬ê¸°í•˜ê³ Â ì‹¶ì—ˆì§€ë§ŒÂ ëê¹Œì§€ í•´ë‚´ê² ë‹¤ëŠ” ì§‘ë…ìœ¼ë¡œ ì™„ë£Œí•œÂ ì‘ì—…ì´ì—ˆê³ , ê²°ê³¼ì ìœ¼ë¡œÂ ì—„ì²­ë‚œ í•™ìŠµ ê²½í—˜ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. ë”Â ë‚˜ì€ ë°©ë²•ì´Â ìˆì„Â ìˆ˜Â ìˆì§€ë§Œ, ë¬¸ì œë¥¼Â í•´ê²°í•˜ê³ Â ê°œë°œìë¡œì„œÂ í•œÂ ë‹¨ê³„ ì„±ì¥í•˜ëŠ”Â ì†Œì¤‘í•œ ê²½í—˜ì´ì—ˆìŠµë‹ˆë‹¤.\n\n\n## ì°¸ê³  ìë£Œ\n\n- [PopupView GitHub Repository](https://github.com/exyte/PopupView)\n- https://ios-development.tistory.com/1233\n- https://docs.swift.org/swift-book/documentation/the-swift-programming-language/automaticreferencecounting/"}]}},"pageContext":{}},"staticQueryHashes":[],"slicesMap":{}}